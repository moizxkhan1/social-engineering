services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - ENVIRONMENT=${ENVIRONMENT:-dev}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DATABASE_URL=${DATABASE_URL:-sqlite:////app/data/data.sqlite3}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-5-nano}
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID:-}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET:-}
      - REDDIT_USERNAME=${REDDIT_USERNAME:-}
      - REDDIT_PASSWORD=${REDDIT_PASSWORD:-}
      - REDDIT_USER_AGENT=${REDDIT_USER_AGENT:-SocialIntelEngine/0.1}
      - REDDIT_MIN_INTERVAL_S=${REDDIT_MIN_INTERVAL_S:-1.0}
      - BROWSER_ENABLED=${BROWSER_ENABLED:-true}
      - BROWSER_HEADLESS=${BROWSER_HEADLESS:-true}
      - BROWSER_TIMEOUT_MS=${BROWSER_TIMEOUT_MS:-30000}
      - CONFIDENCE_THRESHOLD=${CONFIDENCE_THRESHOLD:-0.7}
      - MAX_DISCOVERY_PAGES=${MAX_DISCOVERY_PAGES:-5}
      - MAX_POSTS_PER_SUBREDDIT=${MAX_POSTS_PER_SUBREDDIT:-50}
      - MAX_COMMENTS_PER_POST=${MAX_COMMENTS_PER_POST:-10}
      - MAX_DISCOVERED_SUBREDDITS=${MAX_DISCOVERED_SUBREDDITS:-50}
      - MAX_LLM_SOURCES=${MAX_LLM_SOURCES:-40}
      - LLM_BATCH_SIZE=${LLM_BATCH_SIZE:-5}
      - MAX_SOURCE_CHARS=${MAX_SOURCE_CHARS:-2000}
    ports:
      - "8000:8000"
    volumes:
      - ./backend/app:/app/app
      - ./backend/data:/app/data

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      - NEXT_PUBLIC_API_BASE_URL=http://backend:8000
    ports:
      - "3000:3000"
    depends_on:
      - backend
